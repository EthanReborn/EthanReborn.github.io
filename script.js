//nouns
var nouns = [
    "snake",
    "spartan",
    "ass",
    "duck",
    "viking",
    "vampire",
    "vulture",
    "tri-borg",
    "Bunny",
    "U.S.S Arizona",
    "Aircraft Carrier",
    "Retard",
    "Grigger",
    "Grave Digger",
    "Tom Cruise",
    "Duracell Battery",
    "Robo-cop",
    "Terminator",
    "Cyber Ninja",
    "Ninja",
    "Reptile",
    "Lizard",
    "General",
    "Viltrumite",
    "snowboard",
    "cat",
    "tiger",
    "lion",
    "lemur",
    "sorcerer",
    "wizard",
    "witch",
    "robot",
    "clorox wipe",
    "zombie",
    "hell-spawn",
    "anti-christ",
    "minion",
    "jesus",
    "god",
    "titan",
    "ogre",
    "cyclops",
    "centaur",
    "satyr",
    "necromancer",
    "cyborg",
    "demon",
    "dragon",
    "knight",
    "damsel",
    "woman",
    "man",
    "elemental",
    "troll",
    "experiment",
    "immortal",
    "oni",
    "outworlder",
    "feminist",
    "activist",
    "politician",
    "king",
    "queen",
    "kryptonian",
    "super hero",
    "xenomorph",
    "alien",
    "doll",
    "spirit",
    "ghost",
    "killer",
    "murderer",
    "psychopath",
    "banana",
    "apple",
    "grape",
    "steak",
    "coach",
    "leader",
    "dog-catcher",
    "fire-fighter",
    "actor",
    "movie-star",
    "janitor",
    "plumber",
    "urophiliac",
    "European",
    "Asian",
    "weight lifter",
    "power lifter",
    "teddy bear",
    "burn-victim",
    "wrestler",
    "penguin",
    "octopus",
    "pirate",
    "monster",
    "ballerina",
    "elf",
    "clown",
    "pornstar",
    "mistake",
    "neutron star",
    "ape",
    "baby",
    "terrorist",
    "godzilla",
];

//adjectives
var adjectives = [
    "zombie",
    "genetic",
    "immortal",
    "disinfected",
    "cyber",
    "undead",
    "lame",
    "deaf",
    "immortal",
    "paper",
    "slimy",
    "pissed off",
    "delusional",
    "time",
    "weather",
    "sky",
    "earth",
    "fire",
    "invincible",
    "weird",
    "night",
    "smoke",
    "metal",
    "unhinged",
    "super",
    "invisible",
    "dead",
    "smelly",
    "glass",
    "sleepy",
    "horny",
    "hot",
    "terrifying",
    "insane",
    "useless",
    "bulimic",
    "on fire",
    "old",
    "brutal",
    "kinky",
    "oiled-up",
    "sexist",
    "angry",
    "burnt",
    "wet",
    "screaming",
    "powerful",
    "vengeful",
    "unrelenting",
    "hungry",
    "short",
    "disgusting",
    "robotic",
    "retarded",
    "stupid",
    "handicapped",
    "mentally-challenged",
    "young",
    "inexperienced",
    "experienced",
    "creepy",
    "yodeling",
    "clown",
    "flaming",
    "hypersonic",
    "frozen",
    "cold",
    "improvised",
    "stuffed",
    "telekinetic",
    "made in china",
    "mutant",
    "mutated",
    "nuclear",
    "autistic",
    "obese",
    "fat",
    "fierce",
    "deadly",
    "laser",
    "bald",
    "neutron",
    "mecha",
    "mega",
    "infected",
    "colossal",
    "female",
    "male",
];

//verbs
var verbs = [
    "kill",
    "destroy",
    "invade",
    "pulverize",
    "conquer",
    "decimate",
    "impregnate",
    "make love to",
    "spy on",
    "summon",
    "control",
    "re-animate",
    "teleport",
    "pee on",
    "brutalize",
    "abuse",
    "cook",
    "hire",
    "kiss",
    "lick",
    "spit on",
    "fight",
    "infiltrate",
    "kick",
    "massage",
    "punch",
    "convert",
    "reverse",
    "resurrect",
    "eat",
    "absorb",
    "build",
    "create",
    "invent",
    "climb",
    "vaporize",
];

//firstnames
var firstNames = [
    "Steve",
    "Bob",
    "Will",
    "Mary-Sue",
    "Philip",
    "Peter",
    "Lebron",
    "Arnold",
    "Donald",
    "liu",
    "Walter",
    "Jesse",
    "Santa",
    "Boo-boo",
    "Honey",
    "Michael",
    "Dingster",
    "Wobby",
    "Flapbag",
    "Flapjack",
    "Marco",
    "Mario",
    "Gobsmack",
    "Nick",
    "Ballsac",
    "Lord",
    "King",
    "Cumquat",
    "Dillsack",
    "Margot",
    "Dr.",
    "Mr.",
    "Joseph",
    "Tony",
];

//lastnames
var lastNames = [
    "GoatSucker",
    "RatHumper",
    "NippleTwister",
    "Goldbringer",
    "Runeforged",
    "Hornfeet",
    "Babey-licker",
    "Paint-sniffer",
    "Coolio",
    "Steve",
    "Focker",
    "Schwarzenegger",
    "James",
    "Cruise",
    "Sexton",
    "White",
    "Pinkman",
    "Clause",
    "Christ",
    "Goldfinger",
    "Stark",
    "Kent",
    "Hooboo",
    "Boo-boo",
    "Antetokounmpo",
    "Skywalker",
    "Fett",
    "Hutt",
    "Kenobi",
    "Windu",
    "Gosling",
    "Robbie",
    "Hemsworth",
    "Jackson",
    "Jackoff",
    "Wigglekins",
    "Chewbag",
    "Gillington",
    "Oinkshiner",
    "Snape",
    "Potter",
    "Weasley",
    "McGee",
    "Hitler",
    "Trump",
    "Bin Laden",
    "Stalin",
    "Jr.",
    "Retardo",
    "ButtBottom",
    "HoboHumper",
    "Ballsac",
    "Nimrod",
    "LimpDick",
    "Griffin",
    "beyonce",
];

//weapons
var weapons = [
    "axe",
    "lightsaber",
    "sword",
    "spear",
    "ray gun",
    "nuclear bomb",
    "bomb",
    "rifle",
    "pistol",
    "wand",
    "tank",
    "shoes",
    "video tape",
    "bow",
    "dart gun",
    "sleigh",
    "catapult",
    "trojan horse",
    "helicopter",
    "disc",
    "frisbee",
    "grenade",
    "night-vision",
    "goggles",
    "trident",
    "baskbetball",
    "cat",
    "knife",
    "machete",
    "chainsaw",
    "arm",
    "soap",
    "poison",
    "venom",
    "dildo",
    "rocket launcher",
    "land mine",
    "crow bar",
    "pencil",
    "crock pot",
    "brick",
    "bottle",
    "hair",
    "hairdryer",
    "fire axe",
    "iphone",
    "jet",
    "missile",
    "boulder",
    "laser",
    "wall",
    "fireball",
    "spray bottle",
    "ninja star",
    "shuriken",
    "fork",
    "saw",
    "launcher",
    "spell book",
    "paperclip",
    "gauntlet",
    "portal gun",
];

var locationsAndPlurals = [
    "Atlantis",
    "Alabama",
    "Ugly people",
    "rodents",
    "the World",
    "The Universe",
    "Helicopters",
    "Valhala",
    "Heaven",
    "Oceans",
    "Vampires",
    "Elves",
    "Werewolves",
    "Argentina",
    "fat people",
    "feminists",
    "stupid people",
    "gay people",
    "straight people",
    "Viltrum",
    "Krypton",
    "Mars",
    "Uranus",
    "The Sun",
    "Jupiter",
    "Saturn",
    "Pluto",
    "Neptune",
    "Racists",
    "Mercury",
    "Venus",
    "chickens",
    "giraffes",
    "serial killers",
    "cows",
    "countries",
    "protestors",
    "gamers",
    "Olympus",
    "cancer patients",
    "the outworld",
    "the nether realm",
    "tilted towers",
    "time",
    "dead people",
    "gingers",
    "short people",
    "children",
    "space",
    "The Empire State Building",
    "China",
    "Russia",
    "Disney Land",
    "The 4th Dimension",
    "other dimensions",
    "aliens",
    "cats",
    "ducks",
    "the moon",
    "single moms",
    "autistic people",
    "autistic children",
    "wrestlers",
    "planets",
    "horses",
    "the death star",
    "mt. Everest",
    "the twin towers",
    "babies",
    "technology",
    "homeless people",
];

var abilities = [
    "beauty",
    "bravery",
    "brilliance",
    "brutality",
    "calmness",
    "charity",
    "coldness",
    "compassion",
    "confidence",
    "courage",
    "curiosity",
    "determination",
    "ego",
    "elegance",
    "enthusiasm",
    "envy",
    "evil",
    "faithfulness",
    "fear",
    "generosity",
    "goodness",
    "hatred",
    "helpfulness",
    "honesty",
    "hope",
    "humility",
    "humor",
    "infatuation",
    "insanity",
    "integrity",
    "intelligence",
    "jealousy",
    "kindness",
    "love",
    "loyalty",
    "maturity",
    "patience",
    "perseverance",
    "power",
    "sanity",
    "self-control",
    "sensitivity",
    "sophistication",
    "strength",
    "stupidity",
    "sympathy",
    "talent",
    "tolerance",
    "trust",
    "weakness",
    "wisdom",
    "wit",
    "destruction",
    "speed",
    "jump",
    "killing",
    "reversing",
    "dancing",
    "singing",
    "screaming",
    "flying",
    "vision",
    "lightning",
    "exploding",
    "crying",
    "running",
    "swimming",
    "telekinesis",
    "levitation",
    "shout",
    "manipulation",
    "invisibility",
    "teleportation",
    "force fields",
    "mind control",
    "control",
];


shuffleAll();

var nextDivs = [];
var nextIndex = -3;
var wIndex = 0;
var wordLists = [];

//you are a
wordLists.push(adjectives);
wordLists.push(nouns);
//the
wordLists.push(adjectives);
wordLists.push(nouns);
//destined to
wordLists.push(verbs);
wordLists.push(locationsAndPlurals);
//your name
wordLists.push(firstNames);
wordLists.push(lastNames);
//son of
wordLists.push(firstNames);
wordLists.push(lastNames);
//your weapon
wordLists.push(adjectives);
wordLists.push(weapons);
//special ability
wordLists.push(adjectives);
wordLists.push(abilities);
//your companion
wordLists.push(adjectives);
wordLists.push(nouns);


var head = document.createElement('head');
document.title = "destiny's handbook 2"

var div = document.createElement("div");
div.setAttribute('id', 'main');
div.setAttribute('class', 'stuff-box')


var title = document.createElement('h2');
title.textContent = "Destiny's Handbook 2";

linebreak = document.createElement("br");

var manual = document.createElement('p');
manual.textContent = "click on changing words to select";
manual.setAttribute('class', 'small-text');


//user selection sub-sections
var answer1 = document.createElement('h2');
answer1.textContent = "You Are a: "

var adj1 = document.createElement('p');
adj1.textContent = "";
adj1.setAttribute('id', 'adj1');
adj1.onclick = function () { toggleSelected1(); }
adj1.style.display = "inline";
adj1.className = "text";

var noun1 = document.createElement('p');
noun1.textContent = "";
noun1.setAttribute('id', 'noun1');
noun1.onclick = function () { toggleSelected2(); }
noun1.style.display = "inline";
noun1.className = "text";

var firstContainer = document.createElement('div');
firstContainer.setAttribute('class', 'clear-column');
firstContainer.appendChild(adj1);
firstContainer.appendChild(noun1);



var answer2 = document.createElement('h2');
answer2.textContent = "The: "
nextDivs.push(answer2);

var adj2 = document.createElement('p');
adj2.textContent = "";
adj2.setAttribute('id', 'adj2');
adj2.onclick = function () { toggleSelected1(); }
adj2.style.display = "inline";
adj2.className = "text";
nextDivs.push(adj2);

var noun2 = document.createElement('p');
noun2.textContent = "";
noun2.setAttribute('id', 'noun2');
noun2.onclick = function () { toggleSelected2(); }
noun2.style.display = "inline";
noun2.className = "text";
nextDivs.push(noun2);



var answer3 = document.createElement('h2');
answer3.textContent = "Destined to: "
nextDivs.push(answer3);

var verb1 = document.createElement('p');
verb1.textContent = "";
verb1.setAttribute('id', 'verb1');
verb1.onclick = function () { toggleSelected1(); }
verb1.style.display = "inline";
verb1.className = "text";
nextDivs.push(verb1);

var noun3 = document.createElement('p');
noun3.textContent = "";
noun3.setAttribute('id', 'noun3');
noun3.onclick = function () { toggleSelected2(); }
noun3.style.display = "inline";
noun3.className = "text";
nextDivs.push(noun3);



var answer4 = document.createElement('h2');
answer4.textContent = "Your name: "
nextDivs.push(answer4);

var name3 = document.createElement('p');
name3.textContent = "";
name3.setAttribute('id', 'name3');
name3.onclick = function () { toggleSelected1(); }
name3.style.display = "inline";
name3.className = "text";
nextDivs.push(name3);

var name4 = document.createElement('p');
name4.textContent = "";
name4.setAttribute('id', 'name4');
name4.onclick = function () { toggleSelected2(); }
name4.style.display = "inline";
name4.className = "text";
nextDivs.push(name4);



var answer5 = document.createElement('h2');
answer5.textContent = "Son of: "
nextDivs.push(answer5);

var name1 = document.createElement('p');
name1.textContent = "";
name1.setAttribute('id', 'name1');
name1.onclick = function () { toggleSelected1(); }
name1.style.display = "inline";
name1.className = "text";
nextDivs.push(name1);

var name2 = document.createElement('p');
name2.textContent = "";
name2.setAttribute('id', 'name2');
name2.onclick = function () { toggleSelected2(); }
name2.style.display = "inline";
name2.className = "text";
nextDivs.push(name2);



var answer6 = document.createElement('h2');
answer6.textContent = "Your weapon: "
nextDivs.push(answer6);

var adj3 = document.createElement('p');
adj3.textContent = "";
adj3.setAttribute('id', 'adj3');
adj3.onclick = function () { toggleSelected1(); }
adj3.style.display = "inline";
adj3.className = "text";
nextDivs.push(adj3);

var weapon1 = document.createElement('p');
weapon1.textContent = "";
weapon1.setAttribute('id', 'weapon1');
weapon1.onclick = function () { toggleSelected2(); }
weapon1.style.display = "inline";
weapon1.className = "text";
nextDivs.push(weapon1);



var answer7 = document.createElement('h2');
answer7.textContent = "Special Ability: "
nextDivs.push(answer7);

var adj4 = document.createElement('p');
adj4.textContent = "";
adj4.setAttribute('id', 'adj4');
adj4.onclick = function () { toggleSelected1(); }
adj4.style.display = "inline";
adj4.className = "text";
nextDivs.push(adj4);

var ability1 = document.createElement('p');
ability1.textContent = "";
ability1.setAttribute('id', 'ability1');
ability1.onclick = function () { toggleSelected2(); }
ability1.style.display = "inline";
ability1.className = "text";
nextDivs.push(ability1);



var answer8 = document.createElement('h2');
answer8.textContent = "Your companion: "
nextDivs.push(answer8);

var adj5 = document.createElement('p');
adj5.textContent = "";
adj5.setAttribute('id', 'adj5');
adj5.onclick = function () { toggleSelected1(); }
adj5.style.display = "inline";
adj5.className = "text";
nextDivs.push(adj5);

var noun4 = document.createElement('p');
noun4.textContent = "";
noun4.setAttribute('id', 'noun4');
noun4.onclick = function () { toggleSelected2(); }
noun4.style.display = "inline";
noun4.className = "text";
nextDivs.push(noun4);

var space1 = document.createElement('span');
space1.textContent = "\t \t \t";



//start building DOM
document.body.appendChild(div);
div.appendChild(title);
div.appendChild(manual);
div.appendChild(answer1);
div.appendChild(firstContainer);

//start random wheel for first question
generateNames1(adjectives, 'adj1');
generateNames2(nouns, 'noun1');

//selected flags for each of the two words being randomly generated
var selected1 = false;
var selected2 = false;

var rsTable = document.createElement('div');
document.body.appendChild(rsTable);



//compute.onclick = function(){ click() };

function click() {

    var amount = num1.value;
    var unit = op.value;
    console.log(amount);
    var expression = document.createElement('p');
    var name = op.label;
    console.log(name);

    document.getElementById('loading').textContent = "please wait ...";

    var unitUrl = `http://localhost:8000/unitconv/convert?from=${unit}&to=t_oz&value=${amount}`;

    if(num1.value.length == 0){
        expression.setAttribute('class', 'red');
        expression.textContent = new Date().toLocaleString() + " Error: Missing Input";
        document.getElementById('loading').textContent += " Done";
        rsTable.prepend(expression);
        expression.onclick = function(){rsTable.removeChild(expression)};
        return;
    }
    fetch(unitUrl)
        .then( response => response.json() )
        .then( json => {
            troyOzNum = json['value'];
            console.log(troyOzNum);
            console.log(json);
        })
        .catch( err => {
            let message = `Request to ${unitUrl} did not work`;
            document.getElementById('loading').textContent += " Request to 'localhost:8000/unitconv failed' ...";
            troyOzNum = NaN;
            console.log(message);
        })
        .finally(() => {
            if(!Number.isNaN(troyOzNum)){
                document.getElementById('loading').textContent += "  All done!";
                expression.setAttribute('class', 'stuff-box');
                expression.textContent = new Date().toLocaleString() + " Your worth in GOLD is: " + Number(troyOzNum * curPrice).toFixed(3);
                expression.onclick = function(){rsTable.removeChild(expression)};
                rsTable.prepend(expression);
            }
        })
}

function computeNum() {

    document.getElementById('loading').textContent = "fetching current price of gold ... ";

    var goldUrl = "https://data.nasdaq.com/api/v3/datasets/LBMA/GOLD.json?api_key=tmkky34G3yr4zpS-wAdJ&column_index=1&limit=1";

    fetch(goldUrl)
        .then( response => response.json() )
        .then( json => {
            theData = json;
            curPrice = theData.dataset.data[0][1];
            console.log(curPrice);
        })
        .catch( err => {
            let message = `Request to ${goldUrl} did not work`;
            document.getElementById('loading').textContent += " Request to data.nasdaq.com failed ... ";
            console.log(err);
            return;
        })
        .finally(() => {
            if (curPrice){
                document.getElementById('loading').textContent = "";
                document.getElementById('listPrice').textContent = "The Price of Gold as of " + new Date().toLocaleString() + " is $" + curPrice + " per Troy Ounce.";
            }
        })
}


function generateNames1(inputList, tagName) {
    let index = 0
    let list = inputList;
    function displayNextName() {
        document.getElementById(tagName).textContent = list[index];
        index = (index + 1) % list.length;  // Loop back to the beginning when reaching the end

        if (!selected1) {
            setTimeout(displayNextName, 20); //displayNextName calls itself again in 1/10 of a second
        }
        else{
            return;
        }
    }

    displayNextName();
}

function generateNames2(inputList, tagName) {
    let index = 0
    let list = inputList;
    function displayNextName() {
        document.getElementById(tagName).textContent = list[index];
        index = (index + 1) % list.length;  // Loop back to the beginning when reaching the end

        if (!selected2) {
            setTimeout(displayNextName, 20); //displayNextName calls itself again in 1/10 of a second
        }
        else{
            return;
        }
    }

    displayNextName();
}

function toggleSelected1() {
    console.log("toggle1 selected")
    selected1 = !selected1;

    if(selected1 && selected2){
        nextIndex += 3;
        wIndex += 2;
        console.log("index1 updated")
        setTimeout(completedStep(nextDivs[nextIndex], wordLists[wIndex], wordLists[wIndex + 1]), 10);
    }
}

function toggleSelected2() {
    console.log("toggle2 selected")
    selected2 = !selected2;

    if(selected1 && selected2) {
        nextIndex += 3;
        wIndex += 2;
        console.log("index2 updated")
        setTimeout(completedStep(nextDivs[nextIndex], wordLists[wIndex], wordLists[wIndex + 1]), 10);
    }
}

function completedStep(div, list1, list2) {

    if(nextIndex >= nextDivs.length || wIndex >= wordLists.length){
        let save = document.createElement('button');
        save.setAttribute('class', 'button');
        save.textContent = "Save Character";
        save.onclick = function () { saveCharacter() };

        document.getElementById('main').appendChild(save);
        return;
    }

    shuffleAll();

    let space = document.createElement('p');
    space.textContent = "\t";
    space.style.display = "inline";

    let container = document.createElement('div');
    container.setAttribute('class', 'clear-column');

    document.getElementById('main').appendChild(div);
    container.appendChild(nextDivs[nextIndex + 1]);
    container.appendChild(space);
    container.appendChild(nextDivs[nextIndex + 2]);
    document.getElementById('main').appendChild(container);

    setTimeout(() => {
        selected1 = !selected1;
        selected2 = !selected2;
    }, 100);

    document.getElementById('adj1').setAttribute('class', 'non-hover-text');
    document.getElementById('noun1').setAttribute('class', 'non-hover-text');

    setTimeout(() => generateNames1(list1, nextDivs[nextIndex + 1].id), 100);
    setTimeout(() => generateNames2(list2, nextDivs[nextIndex + 2].id), 200);

    //turn off hover
    for (let i = 0; i < nextIndex; i++) {
        if(nextDivs[i].nodeName == 'P') {
            nextDivs[i].setAttribute('class', 'non-hover-text');
            nextDivs[i].onclick = function () { console.log("dummy function") }
        }
    }

}

function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
}

function shuffleAll() {
    shuffleArray(nouns);
    shuffleArray(adjectives);
    shuffleArray(verbs);
    shuffleArray(firstNames);
    shuffleArray(lastNames);
    shuffleArray(abilities);
    shuffleArray(weapons);
    shuffleArray(locationsAndPlurals);
}

function saveCharacter() {
    let string = "";
    string += "You are a: "
    string += adj1.textContent;
    string += " ";
    string += noun1.textContent;
    string += " ";

    for (let i of nextDivs) {
        if (i.tagName != "P"){
            string += "\n";
        }
        string += i.textContent;
        string += " ";
    }

    const link = document.createElement('a');
    const file = new Blob([string], {type: 'text/plain'});
    link.href = URL.createObjectURL(file);
    link.download = "character.txt";
    link.click();
    URL.revokeObjectURL(link.href);

}

function getImage () {
    generatePDF();
}
